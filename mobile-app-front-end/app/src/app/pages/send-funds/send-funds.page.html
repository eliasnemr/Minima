<ion-app>
<ion-header class="ion-no-border">
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-menu-button class="menu-icon"></ion-menu-button>
    </ion-buttons>
    <ion-title>
      Send
    </ion-title>
  </ion-toolbar>
</ion-header>

<ion-content *ngIf="isCameraOpen==false">

  <ion-grid *ngIf="tokenArr.length == 0">
    <ion-row>
      <ion-col style="display: flex; align-items:center; justify-content:center" size="12">
        <ion-label>Fetching tokens...</ion-label>
      </ion-col>
      <ion-col style="display: flex; align-items:center; justify-content:center" size="12">
        <ion-spinner name="crescent"></ion-spinner>
      </ion-col>
    </ion-row>
  </ion-grid>

  <ion-card class="webscan-canvas" *ngIf="!checkPlatform() && isWebCameraOpen">
    <ion-card-header class="medium-text">
    Scan Your Minima QR address now...
    <ion-progress-bar type="indeterminate" reversed="true"></ion-progress-bar>
    </ion-card-header>
    <video height="240" #videoElem></video>
    <hr>
    <ion-button block="full" (click)="stopWebScanQR()">Stop Scanning</ion-button>
    <hr>
  </ion-card>

  <ion-card class="borders" *ngIf="!isWebCameraOpen && tokenArr.length > 0">
    <ion-card-header>
      Post A Transaction
      <ion-card-title>
          <ion-icon style=" font-size:1.2rem;" slot="start" name="send" class="icon-head medium-text" ></ion-icon>
      </ion-card-title>
    </ion-card-header>

    <ion-card-content>
      <form [formGroup]="sendForm" id="sendForm" (ngSubmit)="sendFunds()">
        <ion-list lines="none">
          <ion-item>
            <ion-label position="fixed" class="medium-text">Token</ion-label>
            <ion-select
              placeholder="Select A Token"
              formControlName="tokenid"    
              interface = 'alert'
              [(ngModel)]='itemSelected'
              class="medium-text input"
              (ionChange)="onItemSelection($event)"> 
            <ion-select-option *ngFor="let token of tokenArr;"  [value]="token.tokenid" class="token-option">
              {{ token.token + "&mdash;"+ token.tokenid }}
            </ion-select-option>
          </ion-select>
          </ion-item>
          <ion-item lines="none">
            <ion-label class="medium-text" position="fixed">Address</ion-label>
            <span (click)="webScanQR()" id="qrIcon"> <ion-icon alt="qrCode" src="assets/scan-outline.svg"></ion-icon></span>
            <ion-input #address class="medium-text input" formControlName="address" clearInput="true" placeholder="address"></ion-input>
          </ion-item>
          <ion-item class="error" lines="none" *ngIf="addressFormItem.invalid && addressFormItem.touched">
            <ion-label position="fixed"></ion-label>
            <ion-note class="error-message">
              <ion-icon name="alert-circle"></ion-icon> <span> Invalid address format!</span> <br>
              <span>&mdash; An address must begin with 0x or Mx.</span> 
            </ion-note>
          </ion-item>
          <ion-item lines="none">
            <ion-label class="medium-text" position="fixed">Amount</ion-label>
            <ion-input #amount type="number" formControlName="amount" class="input medium-text" placeholder="amount"></ion-input>
          </ion-item>
          <ion-item class="error" lines="none" *ngIf="amountFormItem.invalid && amountFormItem.touched">
            <ion-label position="fixed"></ion-label>
            <ion-note class="error-message">
              <ion-icon name="alert-circle"></ion-icon> <span> Amount required!</span> <br>
              <span>&mdash; Amount has to be numeric and greater than 0.</span> 
            </ion-note>
          </ion-item>
          <ion-row id="quickAmount">
            <ion-col size="3">

            </ion-col>
            <ion-col size="9" style="padding-right:2.5%">
              <ion-button class="medium-text" (click)="fillAmount('max')" size="small" fill="outline">Send Max</ion-button>
              <ion-button class="medium-text" (click)="fillAmount('half')" size="small" fill="outline">Send 1/2</ion-button>
              <ion-button class="medium-text" (click)="fillAmount('quarter')" size="small" fill="outline">Send 1/4</ion-button>
            </ion-col>
          </ion-row>
          <ion-item lines="none">
            <!-- Disabled Checkbox -->
            <ion-checkbox (click)="useMessage()"></ion-checkbox>
            <ion-label class="medium-text" [hidden]="messageToggle" style="padding-left: 10px;">Message</ion-label>
            <ion-label class="medium-text" [hidden]="!messageToggle" style="padding-left: 10px;">This message is public</ion-label>
            </ion-item>
            <ion-item [hidden]="!messageToggle" lines="none">
                <ion-textarea 
                [(ngModel)]="data.message"
                formControlName="message"
                class="medium-text input"
                auto-grow="false"
                #message 
                placeholder="type your message..."
                maxlength="255">
                </ion-textarea>
            </ion-item>
            <ion-note *ngIf="data.message" class="length">{{ data.message.length +"/255" }}</ion-note>
        </ion-list>
      </form>
        
        
    </ion-card-content>
  </ion-card>

</ion-content>
<ion-footer>
  <ion-toolbar class="border-t">
    <ion-buttons> 
      <ion-button type="button" class="action-btn medium-text" expand="block" (click)="stopCamera()"  *ngIf="isCameraOpen==true">
        Stop scanning
       </ion-button>
      <ion-button #submitBtn [disabled]="sendForm.invalid" expand="block" *ngIf="isCameraOpen==false">
        <button type="submit" form="sendForm" class="footer">
          <ion-icon slot="start" name="send"></ion-icon> Send Funds
        </button> 
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-footer>
</ion-app>

